<?php

declare(strict_types=1);

use Zend\Http\PhpEnvironment\Request;

try {
    require_once __DIR__ . '/../vendor/autoload.php';
} catch (\Exception $e) {
    echo 'Autoload error: ' . $e->getMessage();
    exit(1);
}

$upwardConfig = getenv('UPWARD_PHP_UPWARD_PATH');
if (!$upwardConfig) {
    // this appears to violate the spec, since we can't kill the server until we receive a request
    // will leave here for right now until we can discuss with Z
    posix_kill(posix_getpid(), SIGKILL);
    exit(1);
}

$controller = new Magento\Upward\Controller(new Request(), $upwardConfig);
echo $controller();
